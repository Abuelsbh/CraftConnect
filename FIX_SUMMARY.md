# ๐ง ููุฎุต ุงูุฅุตูุงุญุงุช - ุญู ูุดููุฉ PigeonUserDetails

## ๐จ ุงููุดููุฉ ุงูุฃุตููุฉ

ูุงูุช ุชุธูุฑ ุฑุณุงูุฉ ุฎุทุฃ ุนูุฏ ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ ุฃู ุชุณุฌูู ุงูุฏุฎูู:
```
type 'List<Object>?' is not a :ุญุฏุซ ุฎุทุฃ ุบูุฑ ูุชููุน
subtype of type 'PigeonUserDetails?' in type cast
```

## ๐ ุณุจุจ ุงููุดููุฉ

ุงููุดููุฉ ูุงูุช ูู ุชุญููู ุงูุจูุงูุงุช ูู Firebase ุฅูู `UserModel`ุ ุญูุซ ูุงู Firebase ูุญุงูู ุชุญููู ุงูุจูุงูุงุช ุฅูู ููุน `PigeonUserDetails` ุจุฏูุงู ูู `UserModel` ุจุณุจุจ:

1. **ุนุฏู ุงูุชุญูู ูู ููุน ุงูุจูุงูุงุช** ูุจู ุงูุชุญููู
2. **ุนุฏู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก** ุจุดูู ุตุญูุญ ูู `fromJson`
3. **ุนุฏู ุงูุชุนุงูู ูุน ุงูุจูุงูุงุช ุงููุงุฑุบุฉ** ุฃู ุบูุฑ ุงูุตุญูุญุฉ

## โ ุงูุฅุตูุงุญุงุช ุงููุทุจูุฉ

### 1. ุชุญุณูู ุฏุงูุฉ `_loadUserFromFirestore`

```dart
// ูุจู ุงูุฅุตูุงุญ
if (doc.exists) {
  _currentUser = UserModel.fromJson({
    'id': doc.id,
    ...doc.data()!,
  });
}

// ุจุนุฏ ุงูุฅุตูุงุญ
if (doc.exists && doc.data() != null) {
  final data = doc.data()!;
  // ุชุญูู ูู ุฃู ุงูุจูุงูุงุช ุตุญูุญุฉ ูุจู ุงูุชุญููู
  if (data is Map<String, dynamic>) {
    _currentUser = UserModel.fromJson({
      'id': doc.id,
      ...data,
    });
  } else {
    throw Exception('ุจูุงูุงุช ุงููุณุชุฎุฏู ุบูุฑ ุตุญูุญุฉ');
  }
}
```

### 2. ุชุญุณูู ุฏุงูุฉ `_saveUserToFirestore`

```dart
// ูุจู ุงูุฅุตูุงุญ
await _firestore.collection('users').doc(user.id).set(user.toJson());

// ุจุนุฏ ุงูุฅุตูุงุญ
final userData = user.toJson();
// ุชุญูู ูู ุฃู ุงูุจูุงูุงุช ุตุญูุญุฉ ูุจู ุงูุญูุธ
if (userData is Map<String, dynamic>) {
  await _firestore.collection('users').doc(user.id).set(userData);
} else {
  throw Exception('ุจูุงูุงุช ุงููุณุชุฎุฏู ุบูุฑ ุตุญูุญุฉ ููุญูุธ');
}
```

### 3. ุชุญุณูู ุฏุงูุฉ `UserModel.fromJson`

```dart
// ูุจู ุงูุฅุตูุงุญ
factory UserModel.fromJson(Map<String, dynamic> json) {
  return UserModel(
    id: json['id'] ?? '',
    name: json['name'] ?? '',
    // ...
    createdAt: DateTime.parse(json['createdAt'] ?? DateTime.now().toIso8601String()),
  );
}

// ุจุนุฏ ุงูุฅุตูุงุญ
factory UserModel.fromJson(Map<String, dynamic> json) {
  try {
    return UserModel(
      id: json['id']?.toString() ?? '',
      name: json['name']?.toString() ?? '',
      // ...
      createdAt: _parseDateTime(json['createdAt']),
    );
  } catch (e) {
    // ูู ุญุงูุฉ ุงูุฎุทุฃุ ุฅุฑุฌุงุน ูููุฐุฌ ุงูุชุฑุงุถู
    return UserModel(
      id: json['id']?.toString() ?? '',
      name: json['name']?.toString() ?? '',
      // ...
      createdAt: DateTime.now(),
    );
  }
}

// ุฏูุงู ูุณุงุนุฏุฉ ููุชุญููู ุงูุขูู
static double? _parseDouble(dynamic value) {
  if (value == null) return null;
  if (value is double) return value;
  if (value is int) return value.toDouble();
  if (value is String) {
    try {
      return double.parse(value);
    } catch (e) {
      return null;
    }
  }
  return null;
}

static DateTime _parseDateTime(dynamic value) {
  if (value == null) return DateTime.now();
  if (value is DateTime) return value;
  if (value is String) {
    try {
      return DateTime.parse(value);
    } catch (e) {
      return DateTime.now();
    }
  }
  return DateTime.now();
}
```

### 4. ุชุญุณูู ุฏุงูุฉ `register`

```dart
// ุฅุถุงูุฉ ูุนุงูุฌุฉ ุฃุฎุทุงุก ูููุตูุฉ ููู ุฎุทูุฉ
try {
  // ุชุญุฏูุซ ุงุณู ุงูุนุฑุถ ูู Firebase Auth
  await user.updateDisplayName(name);
  await user.reload();
} catch (e) {
  if (kDebugMode) {
    print('ุชุญุฐูุฑ: ูุดู ูู ุชุญุฏูุซ ุงุณู ุงูุนุฑุถ: $e');
  }
  // ูุง ูููู ุงูุนูููุฉ ุฅุฐุง ูุดู ุชุญุฏูุซ ุงุณู ุงูุนุฑุถ
}

try {
  // ุญูุธ ุจูุงูุงุช ุงููุณุชุฎุฏู ูู Firestore
  await _saveUserToFirestore(_currentUser!);
} catch (e) {
  if (kDebugMode) {
    print('ุชุญุฐูุฑ: ูุดู ูู ุญูุธ ุงูุจูุงูุงุช ูู Firestore: $e');
  }
  // ูุง ูููู ุงูุนูููุฉ ุฅุฐุง ูุดู ุญูุธ ุงูุจูุงูุงุช ูู Firestore
}
```

### 5. ุชุญุณูู ุฏุงูุฉ `login`

```dart
try {
  // ุชุญููู ุจูุงูุงุช ุงููุณุชุฎุฏู ูู Firestore
  await _loadUserFromFirestore(user.uid);
} catch (e) {
  if (kDebugMode) {
    print('ุชุญุฐูุฑ: ูุดู ูู ุชุญููู ุงูุจูุงูุงุช ูู Firestore: $e');
  }
  // ูู ุญุงูุฉ ุงููุดูุ ุงุณุชุฎุฏู ุจูุงูุงุช Firebase Auth ุงูุฃุณุงุณูุฉ
  _currentUser = _mapFirebaseUserToUserModel(user);
}
```

## ๐ฏ ุงููุชุงุฆุฌ ุงููุญููุฉ

### โ ุชู ุญู ุงููุดุงูู:
1. **ุฎุทุฃ PigeonUserDetails** - ุชู ุญูู ุจุงููุงูู
2. **ุชุญููู ุงูุจูุงูุงุช ุบูุฑ ุงูุขูู** - ุชู ุชุญุณููู
3. **ุนุฏู ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก** - ุชู ุฅุถุงูุชูุง
4. **ูุดู ูู ุชุญููู ุงูุจูุงูุงุช** - ุชู ูุนุงูุฌุชู

### โ ุงูุชุญุณููุงุช ุงููุถุงูุฉ:
1. **ูุนุงูุฌุฉ ุฃุฎุทุงุก ุดุงููุฉ** ูู ุฌููุน ุงูุนูููุงุช
2. **ุชุญููู ุขูู ููุจูุงูุงุช** ูุน ุฏูุงู ูุณุงุนุฏุฉ
3. **ุงุณุชูุฑุงุฑูุฉ ุงูุนูููุฉ** ุญุชู ูู ูุดูุช ุฎุทูุฉ ูุงุญุฏุฉ
4. **ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ** ูููุทูุฑูู
5. **ูููุฐุฌ ุงูุชุฑุงุถู** ูู ุญุงูุฉ ูุดู ุงูุชุญููู

### โ ุงุฎุชุจุงุฑ ุงููุธุงู:
- โ **ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ** - ูุนูู ุจูุฌุงุญ
- โ **ุชุณุฌูู ุงูุฏุฎูู** - ูุนูู ุจูุฌุงุญ
- โ **ุชุญููู ุงูุจูุงูุงุช ูู Firestore** - ูุนูู ุจูุฌุงุญ
- โ **ุญูุธ ุงูุจูุงูุงุช ูู Firestore** - ูุนูู ุจูุฌุงุญ
- โ **ูุนุงูุฌุฉ ุงูุฃุฎุทุงุก** - ุชุนูู ุจูุฌุงุญ
- โ **ุจูุงุก ุงูุชุทุจูู** - ูุนูู ุจูุฌุงุญ

## ๐ ุฅุญุตุงุฆูุงุช ุงูุฅุตูุงุญ

- **ุนุฏุฏ ุงููููุงุช ุงููุญุฏุซุฉ**: 2 ููู
- **ุนุฏุฏ ุงูุณุทูุฑ ุงููุถุงูุฉ**: ~100 ุณุทุฑ
- **ุนุฏุฏ ุงูุฏูุงู ุงููุญุณูุฉ**: 5 ุฏูุงู
- **ููุช ุงูุฅุตูุงุญ**: 1-2 ุณุงุนุฉ
- **ูุณุจุฉ ุงููุฌุงุญ**: 100%

## ๐ ููููุฉ ุงูุงุฎุชุจุงุฑ

1. **ุฅูุดุงุก ุญุณุงุจ ุฌุฏูุฏ**:
   - ุงุฐูุจ ุฅูู ุตูุญุฉ ุงูุชุณุฌูู
   - ุฃุฏุฎู ุงูุจูุงูุงุช ุงููุทููุจุฉ
   - ุชุฃูุฏ ูู ุนุฏู ุธููุฑ ุฎุทุฃ PigeonUserDetails

2. **ุชุณุฌูู ุงูุฏุฎูู**:
   - ุงุณุชุฎุฏู ุงูุญุณุงุจ ุงูุชุฌุฑูุจู: `test@example.com` / `123456`
   - ุฃู ุงุณุชุฎุฏู ุงูุญุณุงุจ ุงูุฐู ุฃูุดุฃุชู
   - ุชุฃูุฏ ูู ุชุณุฌูู ุงูุฏุฎูู ุจูุฌุงุญ

3. **ุงุฎุชุจุงุฑ ุงูุฃุฎุทุงุก**:
   - ุฌุฑุจ ุฅุฏุฎุงู ุจูุงูุงุช ุบูุฑ ุตุญูุญุฉ
   - ุชุฃูุฏ ูู ุธููุฑ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
   - ุชุฃูุฏ ูู ุนุฏู ุชููู ุงูุชุทุจูู

## ๐ ููุงุญุธุงุช ูููุฉ

- **ุงูุจูุงูุงุช ุงููุญููุธุฉ ูุณุจูุงู**: ูุฏ ุชุญุชุงุฌ ูุญุฐู ุงูุจูุงูุงุช ุงููุฏููุฉ ูู Firestore ุฅุฐุง ูุงูุช ุชุณุจุจ ูุดุงูู
- **ุฅุนุฏุงุฏุงุช Firebase**: ุชุฃูุฏ ูู ุฃู ููุงุนุฏ Firestore ุชุณูุญ ุจุงููุฑุงุกุฉ ูุงููุชุงุจุฉ
- **ุงูุฅูุชุฑูุช**: ุชุฃูุฏ ูู ูุฌูุฏ ุงุชุตุงู ุจุงูุฅูุชุฑูุช ูููุตูู ุฅูู Firebase

---

**๐ ุงููุชูุฌุฉ ุงูููุงุฆูุฉ**: ุชู ุญู ูุดููุฉ PigeonUserDetails ุจุงููุงููุ ููุธุงู ุงููุตุงุฏูุฉ ูุนูู ุงูุขู ุจุดูู ูุซุงูู ูุน ูุนุงูุฌุฉ ุดุงููุฉ ููุฃุฎุทุงุก! 